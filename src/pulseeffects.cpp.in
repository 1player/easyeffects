#include <glib-unix.h>
#include "application.hpp"

bool sigterm(void* data){
    auto app = static_cast<Application*>(data);

    app->quit();
    app->pm->~PulseManager();

    return G_SOURCE_REMOVE;
}

int main(int argc, char *argv[]) {
    // Init internationalization support before anything else

    // Intl.setlocale(LocaleCategory.ALL, "");
    // Intl.bindtextdomain("@PROJECT_NAME@", "@LOCALEDIR@");
    // Intl.bind_textdomain_codeset("@PROJECT_NAME@", "UTF-8");
    // Intl.textdomain("@PROJECT_NAME@");

    auto app = Application::create();

    g_unix_signal_add(2, (GSourceFunc)sigterm, app.get());

    auto status = app->run(argc, argv);

    return status;
}
